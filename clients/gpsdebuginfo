#! /bin/sh

# make it easy to pipe/save stderr
exec 2>&1

if (( $UID != 0 )); then
    echo "Please run as root"
fi

# print what we do
set -x
id
uname -a
cat /etc/*release
which gpsd
gpsd -V
# use sockstat, lsof, netstat or ss, depending
if command -v sockstat; then
    sockstat -l | egrep 'gpsd|:2947 '
elif command -v lsof; then
    lsof -iTCP:2947 -s TCP:LISTEN
elif command -v netstat; then
    # FreeBSD does not support "-n"
    netstat -lp | egrep "gpsd|:2947"
elif command -v ss; then
    ss -lpn | egrep 'gpsd|:2947 '
fi
ps ax | fgrep gpsd
which gpspipe
gpspipe -V
gpspipe -w -n 2
echo PYTHONPATH $PYTHONPATH
head -n 1 `which xgps`
if command -v python; then
    python -V
    python -c "import gps;print(gps.__version__)"
fi
if command -v python3; then
    python3 -V
    python3 -c "import gps;print(gps.__version__)"
fi

if command -v systemctl; then
        cat /etc/{default,sysconfig}/gpsd
	systemctl cat gpsd.service
	systemctl cat gpsd.socket
	systemctl status gpsd.service
	systemctl status gpsd.socket
	journalctl -u gpsd.service --since today
fi
